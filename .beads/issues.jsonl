{"id":"panopticon-06z","title":"PAN-81: Register cost-hook in setup hooks command","description":"Update src/cli/commands/setup/hooks.ts to:\n1. Add 'cost-hook' to hookScripts array\n2. Register Stop hook with cost-hook command in Claude settings\n3. Ensure hook is copied to ~/.panopticon/bin/\n\nSimple addition to existing pattern.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T13:58:08.121335483-08:00","created_by":"Eltmon","updated_at":"2026-01-25T17:07:14.499150719-08:00","closed_at":"2026-01-25T17:07:14.499153119-08:00","labels":["PAN-81","difficulty:simple","linear"],"dependencies":[{"issue_id":"panopticon-06z","depends_on_id":"panopticon-fm0","type":"blocks","created_at":"2026-01-25T13:59:18.298326392-08:00","created_by":"Eltmon"}]}
{"id":"panopticon-0zn","title":"PAN-109: Update devcontainer template","description":"Update infra/.devcontainer-template/ to mount entire project and use npm workspaces. Remove individual subdirectory mounts. Add named volumes for each package's node_modules.","status":"open","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T17:00:35.991989102-08:00","created_by":"Eltmon","updated_at":"2026-01-25T17:00:35.991989102-08:00","labels":["PAN-109","difficulty:medium","linear"],"dependencies":[{"issue_id":"panopticon-0zn","depends_on_id":"panopticon-ds7","type":"blocks","created_at":"2026-01-25T17:01:48.350440119-08:00","created_by":"Eltmon"}]}
{"id":"panopticon-12d","title":"PAN-81: Write migration safety tests","description":"CRITICAL: Tests to verify migration doesn't lose data. 1) Parity test - compare old vs new totals, 2) Subagent inclusion test, 3) Empty state test, 4) Partial state recovery test, 5) Idempotency test. Use mock session files with known token counts.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T09:03:27.003720761-08:00","created_by":"Eltmon","updated_at":"2026-01-25T18:19:43.211988808-08:00","closed_at":"2026-01-25T18:19:43.211992008-08:00","labels":["PAN-81","difficulty:medium","linear"],"dependencies":[{"issue_id":"panopticon-12d","depends_on_id":"panopticon-vx8","type":"blocks","created_at":"2026-01-25T09:04:16.803606871-08:00","created_by":"Eltmon"}]}
{"id":"panopticon-1by","title":"PAN-81: Implement retention.ts - 90-day rolling cleanup","description":"Implement cleanOldEvents() to remove events older than 90 days from events.jsonl while preserving aggregates. Run on dashboard startup or daily cron.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T09:02:53.047073311-08:00","created_by":"Eltmon","updated_at":"2026-01-25T17:09:50.601990621-08:00","closed_at":"2026-01-25T17:09:50.601992621-08:00","labels":["PAN-81","difficulty:simple","linear"],"dependencies":[{"issue_id":"panopticon-1by","depends_on_id":"panopticon-rbz","type":"blocks","created_at":"2026-01-25T09:04:15.343662038-08:00","created_by":"Eltmon"}],"comments":[{"id":18,"issue_id":"panopticon-1by","author":"Eltmon","text":"Implemented retention.ts with 90-day rolling cleanup, integrated into dashboard startup, exports added to costs module","created_at":"2026-01-26T01:09:51Z"}]}
{"id":"panopticon-1qv","title":"PAN-91: Implementation","status":"closed","priority":1,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T06:19:59.191066617-08:00","created_by":"Eltmon","updated_at":"2026-01-25T10:31:17.866764458-08:00","closed_at":"2026-01-25T10:31:17.866767058-08:00","labels":["workspace:pan-91"],"comments":[{"id":5,"issue_id":"panopticon-1qv","author":"Eltmon","text":"Implementation complete: Added getActiveSessionModel() to jsonl-parser, updated workspace endpoint to return agentModelFull, added tooltips to frontend agent badge and cost breakdown. All tests pass. Committed and pushed to feature/pan-91.","created_at":"2026-01-25T18:31:20Z"}]}
{"id":"panopticon-25j","title":"PAN-91: Update frontend types and add tooltips","description":"1. Add agentModelFull to WorkspaceInfo interface. 2. Add title tooltip to agent badge showing full model ID. 3. Add getFriendlyModelName() helper function. 4. Add tooltips to cost summary By Model section. Location: src/dashboard/frontend/src/components/IssueDetailPanel.tsx","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T10:25:22.621224346-08:00","created_by":"Eltmon","updated_at":"2026-01-25T10:30:01.59968442-08:00","closed_at":"2026-01-25T10:30:01.599689621-08:00","labels":["PAN-91","difficulty:simple","linear"],"comments":[{"id":4,"issue_id":"panopticon-25j","author":"Eltmon","text":"Updated IssueDetailPanel.tsx: Added agentModelFull to WorkspaceInfo interface, created getFriendlyModelName() helper, added tooltips to agent badge and cost breakdown showing full model IDs.","created_at":"2026-01-25T18:30:04Z"}]}
{"id":"panopticon-2bp","title":"PAN-101: Add agent attribution badges to Kanban issue cards","description":"Main implementation task: Fetch specialists in KanbanBoard, create AgentBadge component, update IssueCard to display which agents are working on each issue. Include conflict warning (slow pulse) when multiple agents on same issue.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T05:36:02.718905964-08:00","created_by":"Eltmon","updated_at":"2026-01-25T05:48:06.842073524-08:00","closed_at":"2026-01-25T05:48:06.842076525-08:00","labels":["PAN-101","difficulty:medium","github"],"comments":[{"id":1,"issue_id":"panopticon-2bp","author":"Eltmon","text":"Implementation complete:\n- Added SpecialistAgent type import to KanbanBoard\n- Added fetchSpecialists function and useQuery with 5s polling\n- Created AgentBadge component with icons and conflict detection\n- Updated IssueCardProps to include specialists array\n- Updated IssueCard rendering to find specialists by currentIssue\n- Replaced model badge with agent attribution badges showing work/planning/specialist agents\n- Added slow-pulse animation when multiple agents detected on same issue\n- All edge cases from STATE.md handled (no agent, single agent, multiple agents, conflict scenarios)","created_at":"2026-01-25T13:46:09Z"}]}
{"id":"panopticon-36v","title":"PAN-109: Update test file imports","description":"Update all 31 test files in tests/ to import from @panopticon/shared instead of relative paths to src/lib. Test imports use patterns like ../../src/lib/ and ../../../src/lib/.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T17:00:16.205792218-08:00","created_by":"Eltmon","updated_at":"2026-01-25T17:11:39.782607315-08:00","closed_at":"2026-01-25T17:11:39.782609616-08:00","labels":["PAN-109","difficulty:medium","linear"],"dependencies":[{"issue_id":"panopticon-36v","depends_on_id":"panopticon-64s","type":"blocks","created_at":"2026-01-25T17:01:35.237055474-08:00","created_by":"Eltmon"},{"issue_id":"panopticon-36v","depends_on_id":"panopticon-ykw","type":"blocks","created_at":"2026-01-25T17:01:35.38554777-08:00","created_by":"Eltmon"}],"comments":[{"id":20,"issue_id":"panopticon-36v","author":"Eltmon","text":"Updated all 29 test files to import from @panopticon/shared instead of relative paths to src/lib. Replaced patterns: ../../../../src/lib/, ../../../src/lib/, ../../src/lib/, ../src/lib/.","created_at":"2026-01-26T01:11:37Z"}]}
{"id":"panopticon-3e8","title":"PAN-81: Update README with cost tracking documentation","description":"Document new cost tracking system in README: how hooks work, data files location, migration process, API endpoints. Include troubleshooting section for when costs aren't appearing.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T09:03:33.90111277-08:00","created_by":"Eltmon","updated_at":"2026-01-25T18:20:45.766738153-08:00","closed_at":"2026-01-25T18:20:45.766741653-08:00","labels":["PAN-81","difficulty:simple","linear"],"dependencies":[{"issue_id":"panopticon-3e8","depends_on_id":"panopticon-zw6","type":"blocks","created_at":"2026-01-25T09:04:17.023479179-08:00","created_by":"Eltmon"},{"issue_id":"panopticon-3e8","depends_on_id":"panopticon-o1i","type":"blocks","created_at":"2026-01-25T09:04:17.183879639-08:00","created_by":"Eltmon"},{"issue_id":"panopticon-3e8","depends_on_id":"panopticon-12d","type":"blocks","created_at":"2026-01-25T09:04:17.364451301-08:00","created_by":"Eltmon"}]}
{"id":"panopticon-3xl","title":"PAN-101: Implementation","status":"closed","priority":1,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T05:28:37.03968541-08:00","created_by":"Eltmon","updated_at":"2026-01-25T05:49:27.946114387-08:00","closed_at":"2026-01-25T05:49:27.946116887-08:00","labels":["workspace:pan-101"]}
{"id":"panopticon-521","title":"PAN-91: Add getActiveSessionModel() to jsonl-parser","description":"Create function to get full model ID from Claude Code session files. Takes workspace path, returns model like 'claude-sonnet-4-5-20250929'. Location: src/lib/cost-parsers/jsonl-parser.ts","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T10:25:06.294615497-08:00","created_by":"Eltmon","updated_at":"2026-01-25T10:27:52.000433053-08:00","closed_at":"2026-01-25T10:27:52.000436153-08:00","labels":["PAN-91","difficulty:simple","linear"],"comments":[{"id":2,"issue_id":"panopticon-521","author":"Eltmon","text":"Added getActiveSessionModel() function to jsonl-parser.ts. Converts workspace path to Claude project dir, finds most recent session file, and extracts full model ID.","created_at":"2026-01-25T18:27:53Z"}]}
{"id":"panopticon-64s","title":"PAN-109: Move src/lib to packages/shared/src","description":"Move all 66 files from src/lib/ to packages/shared/src/. Preserve directory structure (cloister/, cost-parsers/, runtime/, runtimes/, tracker/).","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T17:00:10.084859199-08:00","created_by":"Eltmon","updated_at":"2026-01-25T17:08:03.952006991-08:00","closed_at":"2026-01-25T17:08:03.952011691-08:00","labels":["PAN-109","difficulty:simple","linear"],"dependencies":[{"issue_id":"panopticon-64s","depends_on_id":"panopticon-kjr","type":"blocks","created_at":"2026-01-25T17:01:26.344270996-08:00","created_by":"Eltmon"}],"comments":[{"id":15,"issue_id":"panopticon-64s","author":"Eltmon","text":"Moved all 66 files from src/lib/ to packages/shared/src/ using git mv to preserve history. Removed empty src/lib directory.","created_at":"2026-01-26T01:08:02Z"}]}
{"id":"panopticon-6ua","title":"Test workspace label","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-24T21:04:22.51864039-08:00","created_by":"Eltmon","updated_at":"2026-01-24T21:04:49.510168817-08:00","closed_at":"2026-01-24T21:04:49.510168817-08:00","close_reason":"test cleanup","labels":["workspace:test-123"]}
{"id":"panopticon-6zr","title":"Test workspace label","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-24T21:04:29.155554723-08:00","created_by":"Eltmon","updated_at":"2026-01-24T21:04:49.400888088-08:00","closed_at":"2026-01-24T21:04:49.400888088-08:00","close_reason":"test cleanup","labels":["workspace:test-123"]}
{"id":"panopticon-7g6","title":"PAN-116: Update parseClaudeSession() docstring","description":"Update function docstring for parseClaudeSession():\n\n- Explain per-message pricing approach (vs session-level)\n- Document model display format for multi-model sessions\n- Mark cost field as deprecated, recommend cost_v2\n- Document modelBreakdown structure (keyed by exact model ID)\n- Note: modelBreakdown keys use exact IDs, model field uses normalized names\n\nFile: src/lib/cost-parsers/jsonl-parser.ts (above line 168)","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T20:31:24.654646329-08:00","created_by":"Eltmon","updated_at":"2026-01-25T20:36:23.378557894-08:00","closed_at":"2026-01-25T20:36:23.378560594-08:00","labels":["PAN-116","difficulty:trivial","linear"],"dependencies":[{"issue_id":"panopticon-7g6","depends_on_id":"panopticon-pcv","type":"blocks","created_at":"2026-01-25T20:32:01.400237556-08:00","created_by":"Eltmon"}],"comments":[{"id":26,"issue_id":"panopticon-7g6","author":"Eltmon","text":"Updated docstring to explain per-message pricing, model display format, cost vs cost_v2, and modelBreakdown structure","created_at":"2026-01-26T04:36:23Z"}]}
{"id":"panopticon-7vt","title":"PAN-109: Integration testing in devcontainer","description":"Full integration test: 1) Start devcontainer 2) Verify server starts 3) Verify frontend starts 4) Test hot reload 5) Run npm test in container 6) Spawn agent from container. Document any issues.","status":"open","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T17:00:37.194992587-08:00","created_by":"Eltmon","updated_at":"2026-01-25T17:00:37.194992587-08:00","labels":["PAN-109","difficulty:medium","linear"],"dependencies":[{"issue_id":"panopticon-7vt","depends_on_id":"panopticon-0zn","type":"blocks","created_at":"2026-01-25T17:01:49.878815481-08:00","created_by":"Eltmon"}]}
{"id":"panopticon-8rk","title":"PAN-81: Create cost tracking module structure","description":"Create src/lib/costs/ directory with index.ts, types.ts. Define interfaces for CostEvent, CostCache, MigrationState. Simple scaffolding task.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T09:02:29.484948478-08:00","created_by":"Eltmon","updated_at":"2026-01-25T15:57:18.026190664-08:00","closed_at":"2026-01-25T15:57:18.026193064-08:00","labels":["PAN-81","difficulty:simple","linear"],"comments":[{"id":6,"issue_id":"panopticon-8rk","author":"Eltmon","text":"Created module structure: types.ts, index.ts, pricing.ts","created_at":"2026-01-25T23:57:16Z"}]}
{"id":"panopticon-8y5","title":"PAN-81: Implementation","status":"closed","priority":1,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T06:19:21.887372313-08:00","created_by":"Eltmon","updated_at":"2026-01-25T18:22:20.026090004-08:00","closed_at":"2026-01-25T18:22:20.026093404-08:00","labels":["workspace:pan-81"],"comments":[{"id":23,"issue_id":"panopticon-8y5","author":"Eltmon","text":"Implementation complete - all acceptance criteria met:\n- Event-sourced cost tracking with hooks\n- Real-time event logging to events.jsonl\n- Pre-computed cache for O(1) cost queries\n- Historical migration from workspace session files\n- 90-day retention cleanup\n- Subagent cost tracking included\n- Migration safety tests (8 test cases, all passing)\n- Event count tracking per issue\n- README documentation updated\n- All code committed and pushed to remote\n\nReady for review and merge.","created_at":"2026-01-26T02:22:44Z"}]}
{"id":"panopticon-a3a","title":"PAN-109: Update CLI command imports","description":"Update all 41 CLI command files in src/cli/commands/ to import from @panopticon/shared instead of ../lib or ../../lib. Pattern: '../lib/foo.js' -\u003e '@panopticon/shared/foo.js'","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T17:00:13.530938537-08:00","created_by":"Eltmon","updated_at":"2026-01-25T17:09:48.501565084-08:00","closed_at":"2026-01-25T17:09:48.501568384-08:00","labels":["PAN-109","difficulty:medium","linear"],"dependencies":[{"issue_id":"panopticon-a3a","depends_on_id":"panopticon-64s","type":"blocks","created_at":"2026-01-25T17:01:31.414073324-08:00","created_by":"Eltmon"},{"issue_id":"panopticon-a3a","depends_on_id":"panopticon-ykw","type":"blocks","created_at":"2026-01-25T17:01:31.558335418-08:00","created_by":"Eltmon"}],"comments":[{"id":17,"issue_id":"panopticon-a3a","author":"Eltmon","text":"Updated all 40 CLI command files to import from @panopticon/shared instead of relative ../lib paths. Used sed to batch replace '../../../lib/', '../../lib/', and '../lib/' imports.","created_at":"2026-01-26T01:09:46Z"}]}
{"id":"panopticon-b3t","title":"PAN-81: Handle SubagentStop hook for subagent costs","description":"Update scripts/cost-hook to also handle SubagentStop events:\n\n1. Check hook_event_name in stdin JSON\n2. If SubagentStop, use agent_transcript_path instead of transcript_path\n3. Use parent agent's issue ID for cost attribution\n4. Append event with subagent indicator\n\nThe Stop hook already runs for main agents; SubagentStop fires when subagents complete.\nSame hook script, just different input parsing.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T13:58:31.894029378-08:00","created_by":"Eltmon","updated_at":"2026-01-25T17:07:23.075403407-08:00","closed_at":"2026-01-25T17:07:23.075406607-08:00","labels":["PAN-81","difficulty:simple","linear"],"dependencies":[{"issue_id":"panopticon-b3t","depends_on_id":"panopticon-fm0","type":"blocks","created_at":"2026-01-25T13:59:19.547284826-08:00","created_by":"Eltmon"}]}
{"id":"panopticon-clk","title":"PAN-116: Update SessionUsage interface with cost_v2 and modelBreakdown fields","description":"Add optional fields to SessionUsage interface in jsonl-parser.ts:\n- cost_v2?: number (accurate per-message pricing)\n- modelBreakdown?: Record\u003cstring, { cost, inputTokens, outputTokens, messageCount }\u003e\n\nMark existing cost field as deprecated in comment.\n\nFile: src/lib/cost-parsers/jsonl-parser.ts (lines 40-49)","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T20:31:20.459982931-08:00","created_by":"Eltmon","updated_at":"2026-01-25T20:34:52.56628211-08:00","closed_at":"2026-01-25T20:34:52.56628431-08:00","labels":["PAN-116","difficulty:trivial","linear"],"comments":[{"id":24,"issue_id":"panopticon-clk","author":"Eltmon","text":"Added cost_v2 and modelBreakdown fields to SessionUsage interface with descriptive comments","created_at":"2026-01-26T04:34:52Z"}]}
{"id":"panopticon-ds7","title":"PAN-109: Update build configuration","description":"Update tsup.config.ts to handle new package structure. Update tsconfig.json with paths aliases for @panopticon/shared. Ensure npm run build produces working CLI and dashboard.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T17:00:32.745585817-08:00","created_by":"Eltmon","updated_at":"2026-01-25T17:33:55.718497273-08:00","closed_at":"2026-01-25T17:33:55.718497273-08:00","close_reason":"Build configuration successfully updated and tested","labels":["PAN-109","difficulty:medium","linear"],"dependencies":[{"issue_id":"panopticon-ds7","depends_on_id":"panopticon-a3a","type":"blocks","created_at":"2026-01-25T17:01:46.115050763-08:00","created_by":"Eltmon"},{"issue_id":"panopticon-ds7","depends_on_id":"panopticon-l2u","type":"blocks","created_at":"2026-01-25T17:01:46.271439728-08:00","created_by":"Eltmon"},{"issue_id":"panopticon-ds7","depends_on_id":"panopticon-36v","type":"blocks","created_at":"2026-01-25T17:01:46.425422389-08:00","created_by":"Eltmon"},{"issue_id":"panopticon-ds7","depends_on_id":"panopticon-t55","type":"blocks","created_at":"2026-01-25T17:01:46.62960189-08:00","created_by":"Eltmon"},{"issue_id":"panopticon-ds7","depends_on_id":"panopticon-mnd","type":"blocks","created_at":"2026-01-25T17:02:07.865345873-08:00","created_by":"Eltmon"}],"comments":[{"id":22,"issue_id":"panopticon-ds7","author":"Eltmon","text":"Build configuration updated:\n- Added workspaces config to root package.json (packages/*, dashboard/server, dashboard/frontend)\n- Added @panopticon/shared paths alias to tsconfig.json\n- Added @panopticon/shared dependency to dashboard server package.json\n- Verified all builds work: CLI (tsup), dashboard server (esbuild), dashboard frontend (vite)\n- All 520 tests pass","created_at":"2026-01-26T01:33:54Z"}]}
{"id":"panopticon-e2j","title":"PAN-81: Implement historical cost migration","description":"Create src/lib/costs/migration.ts that:\n1. Checks if ~/.panopticon/costs/migration-complete exists (skip if so)\n2. For each workspace in ~/.panopticon/agents/*/state.json:\n   - Get workspace path and issue ID\n   - Parse all session files including subagents/\n   - Convert to event format and append to events.jsonl\n3. Parse any sessions NOT linked to agents as 'unassigned'\n4. Rebuild by-issue.json from events.jsonl\n5. Create migration-complete marker file\n\nComplex: Must handle large files, many workspaces, subagent directories.\nCross-cutting: Uses aggregator.ts, events.ts, pricing.ts","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T13:58:16.394977687-08:00","created_by":"Eltmon","updated_at":"2026-01-25T17:07:11.720215376-08:00","closed_at":"2026-01-25T17:07:11.720217576-08:00","labels":["PAN-81","difficulty:complex","linear"],"dependencies":[{"issue_id":"panopticon-e2j","depends_on_id":"panopticon-qkr","type":"blocks","created_at":"2026-01-25T13:59:20.749621232-08:00","created_by":"Eltmon"}]}
{"id":"panopticon-fm0","title":"PAN-81: Create cost-hook bash script for Stop event","description":"Create scripts/cost-hook that:\n1. Receives JSON via stdin with transcript_path\n2. Uses tail + jq to get last few entries from transcript\n3. Extracts message.usage (input, output, cache_read, cache_write tokens)\n4. Gets agent ID from PANOPTICON_AGENT_ID or tmux session name\n5. Looks up issue ID from agent state file\n6. Appends event to ~/.panopticon/costs/events.jsonl\n\nMust handle:\n- Missing agent ID (use 'main-cli' or 'unassigned')\n- Missing issue mapping (use 'unassigned')\n- Error resilience (never break Claude Code)\n\nPattern: Similar to heartbeat-hook, simple bash with jq.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T13:57:57.08054926-08:00","created_by":"Eltmon","updated_at":"2026-01-25T17:07:12.910463179-08:00","closed_at":"2026-01-25T17:07:12.910465379-08:00","labels":["PAN-81","difficulty:medium","linear"],"dependencies":[{"issue_id":"panopticon-fm0","depends_on_id":"panopticon-qkr","type":"blocks","created_at":"2026-01-25T13:59:17.268700052-08:00","created_by":"Eltmon"}]}
{"id":"panopticon-j0i","title":"PAN-91: Update workspace endpoint to return full model ID","description":"Add agentModelFull field to workspace API response. Call getActiveSessionModel() when agent is running. Location: src/dashboard/server/index.ts around line 3689","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T10:25:11.917598937-08:00","created_by":"Eltmon","updated_at":"2026-01-25T10:28:45.788086668-08:00","closed_at":"2026-01-25T10:28:45.788092169-08:00","labels":["PAN-91","difficulty:simple","linear"],"comments":[{"id":3,"issue_id":"panopticon-j0i","author":"Eltmon","text":"Updated workspace endpoint to call getActiveSessionModel() and return agentModelFull in response. Added import and integrated with existing agentModel extraction.","created_at":"2026-01-25T18:28:48Z"}]}
{"id":"panopticon-kjr","title":"PAN-109: Create packages/shared package structure","description":"Create packages/shared/ directory with package.json (@panopticon/shared) and tsconfig.json. Include all dependencies from root that lib modules use (@iarna/toml, yaml, etc.)","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T16:59:54.053862821-08:00","created_by":"Eltmon","updated_at":"2026-01-25T17:06:20.345544377-08:00","closed_at":"2026-01-25T17:06:20.345547177-08:00","labels":["PAN-109","difficulty:simple","linear"],"comments":[{"id":13,"issue_id":"panopticon-kjr","author":"Eltmon","text":"Created packages/shared directory structure with package.json (@panopticon/shared) including dependencies: @iarna/toml, @linear/sdk, @octokit/rest, better-sqlite3, yaml. Created tsconfig.json extending root config.","created_at":"2026-01-26T01:06:19Z"}]}
{"id":"panopticon-l2u","title":"PAN-109: Update dashboard server imports","description":"Update src/dashboard/server/index.ts to import from @panopticon/shared instead of ../../lib. About 18 import statements need updating.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T17:00:14.78014387-08:00","created_by":"Eltmon","updated_at":"2026-01-25T17:10:21.854264987-08:00","closed_at":"2026-01-25T17:10:21.854268987-08:00","labels":["PAN-109","difficulty:simple","linear"],"dependencies":[{"issue_id":"panopticon-l2u","depends_on_id":"panopticon-64s","type":"blocks","created_at":"2026-01-25T17:01:33.361917049-08:00","created_by":"Eltmon"},{"issue_id":"panopticon-l2u","depends_on_id":"panopticon-ykw","type":"blocks","created_at":"2026-01-25T17:01:33.512518006-08:00","created_by":"Eltmon"}],"comments":[{"id":19,"issue_id":"panopticon-l2u","author":"Eltmon","text":"Updated src/dashboard/server/index.ts with 14 import statements changed from '../../lib/' to '@panopticon/shared/'.","created_at":"2026-01-26T01:10:20Z"}]}
{"id":"panopticon-lbz","title":"PAN-81: Update /api/costs/by-issue to use pre-computed cache","description":"Update src/dashboard/server/index.ts:\n\n1. Replace current implementation with:\n   - Read ~/.panopticon/costs/by-issue.json\n   - Return cached data directly (O(1) lookup)\n\n2. Add /api/costs/rebuild endpoint:\n   - Triggers full reconciliation from events.jsonl\n   - Rebuilds by-issue.json cache\n   - Returns new totals\n\n3. On dashboard startup:\n   - Check if migration needed (no migration-complete marker)\n   - Run migration async (non-blocking)\n\n4. Remove parseWorkspaceSessionUsageAsync function (dead code after migration)\n\nMedium complexity: Multiple changes but straightforward logic.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T13:58:23.915274555-08:00","created_by":"Eltmon","updated_at":"2026-01-25T17:07:10.222614916-08:00","closed_at":"2026-01-25T17:07:10.222616916-08:00","labels":["PAN-81","difficulty:medium","linear"],"dependencies":[{"issue_id":"panopticon-lbz","depends_on_id":"panopticon-e2j","type":"blocks","created_at":"2026-01-25T13:59:22.42529301-08:00","created_by":"Eltmon"},{"issue_id":"panopticon-lbz","depends_on_id":"panopticon-fm0","type":"blocks","created_at":"2026-01-25T13:59:22.52807732-08:00","created_by":"Eltmon"}]}
{"id":"panopticon-mnd","title":"PAN-109: Update paths.ts dev-mode detection","description":"Update src/lib/paths.ts (after move: packages/shared/src/paths.ts) to detect dev mode correctly. Current logic checks for /src/ in path. Need to update for /packages/shared/src/ path.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T17:00:31.171230186-08:00","created_by":"Eltmon","updated_at":"2026-01-25T17:12:13.381630633-08:00","closed_at":"2026-01-25T17:12:13.381633233-08:00","labels":["PAN-109","difficulty:simple","linear"],"dependencies":[{"issue_id":"panopticon-mnd","depends_on_id":"panopticon-64s","type":"blocks","created_at":"2026-01-25T17:01:29.367193186-08:00","created_by":"Eltmon"}],"comments":[{"id":21,"issue_id":"panopticon-mnd","author":"Eltmon","text":"Updated packages/shared/src/paths.ts dev-mode detection to check for /packages/shared/src instead of /src/. Updated dirname calls to go up three levels (dirname(dirname(dirname(currentDir)))) to reach package root.","created_at":"2026-01-26T01:12:12Z"}]}
{"id":"panopticon-nay","title":"PAN-81: Implement aggregator.ts - cache management","description":"Implement loadCache(), saveCache(), updateCacheFromEvent(), rebuildFromEvents(). Cache format: by-issue.json with version, status, lastEventTs, lastEventLine, issues map.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T09:02:41.310279806-08:00","created_by":"Eltmon","updated_at":"2026-01-25T15:58:59.514729866-08:00","closed_at":"2026-01-25T15:58:59.514732066-08:00","labels":["PAN-81","difficulty:medium","linear"],"dependencies":[{"issue_id":"panopticon-nay","depends_on_id":"panopticon-8rk","type":"blocks","created_at":"2026-01-25T09:04:14.656163192-08:00","created_by":"Eltmon"}],"comments":[{"id":8,"issue_id":"panopticon-nay","author":"Eltmon","text":"Implemented aggregator.ts with loadCache, saveCache, updateCacheFromEvent, rebuildFromEvents, incremental updates","created_at":"2026-01-25T23:58:58Z"}]}
{"id":"panopticon-nfu","title":"PAN-81: Register cost-hook in setup hooks command","description":"Update src/cli/commands/setup/hooks.ts to install cost-hook alongside existing heartbeat/pre-tool/stop hooks. Copy script to ~/.panopticon/bin/ and register in ~/.claude/settings.json.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T09:03:04.374593583-08:00","created_by":"Eltmon","updated_at":"2026-01-25T16:04:37.136309215-08:00","closed_at":"2026-01-25T16:04:37.136311515-08:00","labels":["PAN-81","difficulty:simple","linear"],"dependencies":[{"issue_id":"panopticon-nfu","depends_on_id":"panopticon-plo","type":"blocks","created_at":"2026-01-25T09:04:15.824748212-08:00","created_by":"Eltmon"}],"comments":[{"id":12,"issue_id":"panopticon-nfu","author":"Eltmon","text":"Updated setup hooks command: added cost-hook to hookScripts array, registered as Stop hook, updated success messages","created_at":"2026-01-26T00:04:35Z"}]}
{"id":"panopticon-o1i","title":"PAN-81: Add status badge to MetricsSummary component","description":"Add badge to MetricsSummary.tsx showing 'Live' (green), 'Migrating' (yellow), or 'Stale' (red) based on /api/costs/status response. Stale = no events in 24h.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T09:03:21.029815945-08:00","created_by":"Eltmon","updated_at":"2026-01-25T17:54:12.610515868-08:00","closed_at":"2026-01-25T17:54:12.610532569-08:00","labels":["PAN-81","difficulty:simple","linear"],"dependencies":[{"issue_id":"panopticon-o1i","depends_on_id":"panopticon-on8","type":"blocks","created_at":"2026-01-25T09:04:16.653474572-08:00","created_by":"Eltmon"}]}
{"id":"panopticon-on8","title":"PAN-81: Update dashboard API endpoints","description":"Update /api/costs/by-issue to read from cache (O(1) lookup). Add /api/costs/rebuild for manual rebuild. Add /api/costs/status for migration status. Remove old parseWorkspaceSessionUsageAsync calls from cost endpoints.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T09:03:09.631152555-08:00","created_by":"Eltmon","updated_at":"2026-01-25T16:03:40.754132362-08:00","closed_at":"2026-01-25T16:03:40.754135062-08:00","labels":["PAN-81","difficulty:medium","linear"],"dependencies":[{"issue_id":"panopticon-on8","depends_on_id":"panopticon-nay","type":"blocks","created_at":"2026-01-25T09:04:16.108974435-08:00","created_by":"Eltmon"}],"comments":[{"id":11,"issue_id":"panopticon-on8","author":"Eltmon","text":"Updated dashboard endpoints: /api/costs/by-issue reads from cache, added /api/costs/update-cache, /api/costs/rebuild, /api/costs/status, /api/costs/migrate, added migration trigger on startup","created_at":"2026-01-26T00:03:39Z"}]}
{"id":"panopticon-pcv","title":"PAN-116: Implement per-message cost calculation in parseClaudeSession()","description":"Replace session-level costing with per-message costing in parseClaudeSession():\n\n1. Initialize modelBreakdown map and totalCostV2 variable\n2. In message loop:\n   - Extract model ID (exact) and usage for each message\n   - Normalize model name for pricing lookup\n   - Calculate cost for this message using its model pricing\n   - Update modelBreakdown[modelId] with cost/tokens/count\n   - Accumulate totalCostV2\n3. Generate model display string:\n   - Extract normalized model names from breakdown\n   - Join with ' → ' if multiple models (e.g., 'claude-sonnet-4.5 → claude-opus-4.5')\n4. Keep old cost calculation for backward compatibility\n5. Return SessionUsage with cost, cost_v2, and modelBreakdown\n\nFile: src/lib/cost-parsers/jsonl-parser.ts (lines 168-259)","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T20:31:21.802457501-08:00","created_by":"Eltmon","updated_at":"2026-01-25T20:35:50.958001907-08:00","closed_at":"2026-01-25T20:35:50.958005307-08:00","labels":["PAN-116","difficulty:medium","linear"],"dependencies":[{"issue_id":"panopticon-pcv","depends_on_id":"panopticon-clk","type":"blocks","created_at":"2026-01-25T20:32:01.107860235-08:00","created_by":"Eltmon"}],"comments":[{"id":25,"issue_id":"panopticon-pcv","author":"Eltmon","text":"Implemented per-message cost calculation: tracks modelBreakdown by exact model ID, calculates cost_v2 with accurate per-message pricing, generates model display string with → for upgrades","created_at":"2026-01-26T04:35:51Z"}]}
{"id":"panopticon-plo","title":"PAN-81: Create cost-hook script","description":"Create scripts/cost-hook bash script that extracts usage from Claude Code PostToolUse event stdin, writes to events.jsonl. Must be resilient (never break Claude Code), log errors to errors.log. Works for both main agents AND subagents.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T09:02:58.863262883-08:00","created_by":"Eltmon","updated_at":"2026-01-25T16:02:01.084433033-08:00","closed_at":"2026-01-25T16:02:01.084435333-08:00","labels":["PAN-81","difficulty:medium","linear"],"dependencies":[{"issue_id":"panopticon-plo","depends_on_id":"panopticon-rbz","type":"blocks","created_at":"2026-01-25T09:04:15.589897086-08:00","created_by":"Eltmon"}],"comments":[{"id":10,"issue_id":"panopticon-plo","author":"Eltmon","text":"Created scripts/cost-hook with usage extraction, file locking, error logging, works for main and subagents","created_at":"2026-01-26T00:01:59Z"}]}
{"id":"panopticon-qkr","title":"PAN-81: Create cost tracking module with pricing constants","description":"Create src/lib/costs/ module with:\n- pricing.ts: Move MODEL_PRICING from server/index.ts\n- events.ts: Append/read utilities for events.jsonl\n- aggregator.ts: Load/update by-issue.json cache\n- index.ts: Exports\n\nSimple refactoring - extract existing code into dedicated module.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T13:57:45.430061995-08:00","created_by":"Eltmon","updated_at":"2026-01-25T15:57:30.243235895-08:00","closed_at":"2026-01-25T15:57:30.243238795-08:00","labels":["PAN-81","difficulty:simple","linear"]}
{"id":"panopticon-rbz","title":"PAN-81: Implement events.ts - event log read/write","description":"Implement appendEvent() to write to events.jsonl, readEvents() to read with offset/limit, getLastEventLine() for resumption. Include file locking for concurrent writes.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T09:02:35.70493541-08:00","created_by":"Eltmon","updated_at":"2026-01-25T15:58:15.828377855-08:00","closed_at":"2026-01-25T15:58:15.828381155-08:00","labels":["PAN-81","difficulty:medium","linear"],"dependencies":[{"issue_id":"panopticon-rbz","depends_on_id":"panopticon-8rk","type":"blocks","created_at":"2026-01-25T09:04:14.394148782-08:00","created_by":"Eltmon"}],"comments":[{"id":7,"issue_id":"panopticon-rbz","author":"Eltmon","text":"Implemented events.ts with appendEvent, readEvents, getLastEventLine, file locking","created_at":"2026-01-25T23:58:14Z"}]}
{"id":"panopticon-t55","title":"PAN-109: Update src/index.ts re-exports","description":"Update src/index.ts to re-export from @panopticon/shared instead of ./lib. This maintains the public API for consumers of panopticon-cli package.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T17:00:34.218449963-08:00","created_by":"Eltmon","updated_at":"2026-01-25T17:08:35.148232577-08:00","closed_at":"2026-01-25T17:08:35.148235378-08:00","labels":["PAN-109","difficulty:simple","linear"],"dependencies":[{"issue_id":"panopticon-t55","depends_on_id":"panopticon-64s","type":"blocks","created_at":"2026-01-25T17:01:43.81096258-08:00","created_by":"Eltmon"},{"issue_id":"panopticon-t55","depends_on_id":"panopticon-ykw","type":"blocks","created_at":"2026-01-25T17:01:43.975169377-08:00","created_by":"Eltmon"}],"comments":[{"id":16,"issue_id":"panopticon-t55","author":"Eltmon","text":"Updated src/index.ts to re-export from @panopticon/shared instead of ./lib. Public API maintained for panopticon-cli package consumers.","created_at":"2026-01-26T01:08:33Z"}]}
{"id":"panopticon-vx8","title":"PAN-81: Implement migration.ts - historical data import","description":"One-time migration: parse ALL existing session files including subagents/ subdirectories. Must be idempotent, resumable, and non-blocking. Write migration marker when complete. CRITICAL: Include parity tests comparing old vs new totals.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T09:02:47.478532341-08:00","created_by":"Eltmon","updated_at":"2026-01-25T16:00:56.500370334-08:00","closed_at":"2026-01-25T16:00:56.500372534-08:00","labels":["PAN-81","difficulty:complex","linear"],"dependencies":[{"issue_id":"panopticon-vx8","depends_on_id":"panopticon-rbz","type":"blocks","created_at":"2026-01-25T09:04:14.908656981-08:00","created_by":"Eltmon"},{"issue_id":"panopticon-vx8","depends_on_id":"panopticon-nay","type":"blocks","created_at":"2026-01-25T09:04:15.123379008-08:00","created_by":"Eltmon"}],"comments":[{"id":9,"issue_id":"panopticon-vx8","author":"Eltmon","text":"Implemented migration.ts with runMigration, parseWorkspaceSessionsToEvents, includes subagent support, idempotent with migration marker","created_at":"2026-01-26T00:00:55Z"}]}
{"id":"panopticon-ykw","title":"PAN-109: Update root package.json with workspaces","description":"Add workspaces config to root package.json. Move packages/shared dependencies to shared package.json. Update scripts for workspace commands.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T17:00:11.652986135-08:00","created_by":"Eltmon","updated_at":"2026-01-25T17:07:31.029972952-08:00","closed_at":"2026-01-25T17:07:31.029975752-08:00","labels":["PAN-109","difficulty:simple","linear"],"dependencies":[{"issue_id":"panopticon-ykw","depends_on_id":"panopticon-kjr","type":"blocks","created_at":"2026-01-25T17:01:28.074099963-08:00","created_by":"Eltmon"}],"comments":[{"id":14,"issue_id":"panopticon-ykw","author":"Eltmon","text":"Added workspaces config to root package.json: packages/shared, src/dashboard/server, src/dashboard/frontend. Dependencies remain in root for CLI build, workspace packages have their own.","created_at":"2026-01-26T01:07:29Z"}]}
{"id":"panopticon-yld","title":"PAN-116: Add test cases for multi-model session cost calculation","description":"Add new test suite for parseClaudeSession() multi-model handling:\n\nTest cases:\n1. Single-model session - Verify cost matches original behavior\n2. Sonnet → Opus upgrade - Verify:\n   - cost_v2 \u003e cost (accurate vs first-model pricing)\n   - modelBreakdown has both models with exact IDs as keys\n   - Opus messages cost ~5x more per message than Sonnet\n   - model display shows normalized progression\n3. Multiple model switches - Verify breakdown tracks all models\n4. Session with no usage - Returns null\n5. All messages same model - Verify cost ≈ cost_v2\n\nUse synthetic test data (helper to generate JSONL messages).\n\nFile: tests/lib/cost-parsers/jsonl-parser.test.ts","status":"in_progress","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T20:31:22.854023688-08:00","created_by":"Eltmon","updated_at":"2026-01-25T20:36:34.004159412-08:00","labels":["PAN-116","difficulty:simple","linear"],"dependencies":[{"issue_id":"panopticon-yld","depends_on_id":"panopticon-pcv","type":"blocks","created_at":"2026-01-25T20:32:01.254040646-08:00","created_by":"Eltmon"}]}
{"id":"panopticon-zw6","title":"PAN-81: Add migration trigger on dashboard startup","description":"On dashboard startup, check if migration marker exists. If not, trigger non-blocking migration in background. Update cache status to 'migrating' during migration, 'live' when complete.","status":"closed","priority":2,"issue_type":"task","owner":"eltmon@gmail.com","created_at":"2026-01-25T09:03:15.089106711-08:00","created_by":"Eltmon","updated_at":"2026-01-25T16:03:51.050023112-08:00","closed_at":"2026-01-25T16:03:51.050026112-08:00","labels":["PAN-81","difficulty:simple","linear"],"dependencies":[{"issue_id":"panopticon-zw6","depends_on_id":"panopticon-vx8","type":"blocks","created_at":"2026-01-25T09:04:16.323906073-08:00","created_by":"Eltmon"},{"issue_id":"panopticon-zw6","depends_on_id":"panopticon-on8","type":"blocks","created_at":"2026-01-25T09:04:16.48278075-08:00","created_by":"Eltmon"}]}
